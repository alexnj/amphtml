<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
  </head>
  <body>
    <h3>Intersection Ratios:</h3>
    <p id="intersections"></p>
    <script>
      window.parent.postMessage(
        {
          sentinel: 'amp',
          type: 'send-intersections',
        },
        '*'
      );

      function isAmpMessage(event, type) {
        return (
          event.source == window.parent &&
          event.origin != window.location.origin &&
          event.data &&
          event.data.sentinel == 'amp' &&
          event.data.type == type
        );
      }
      window.addEventListener('message', (event) => {
        if (event.data.sentinel !== 'amp' && event.data.type !== 'intersection') {
          return;
        }
        event.data.changes.forEach((change) => {
          const node = document.getElementById('intersections');
          node.innerHTML += '<p>' + change.intersectionRatio + '</p>';
        });
      });
    </script>
  </body>
</html>
